<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="./vite.svg" />
    <meta
      name="viewport"
      content="width=device-width,user-scalable=no,initial-scale=1,viewport-fit=cover"
    />
    <title></title>
    <script type="module" crossorigin src="./assets/index-BYsxjsOU.js"></script>
    <link rel="modulepreload" crossorigin href="./assets/vue-vendor-NS_2C0XN.js">
    <link rel="modulepreload" crossorigin href="./assets/three-vendor-KrZCfKzS.js">
    <link rel="modulepreload" crossorigin href="./assets/@mkkellogg/gaussian-splats-3d-vendor-CyRDQ3LD.js">
    <link rel="modulepreload" crossorigin href="./assets/@sparkjsdev/spark-vendor-D_YURDPx.js">
    <link rel="stylesheet" crossorigin href="./assets/index-XEcxq8Gy.css">
  </head>
  <body>
    <div id="app"></div>
    <script
      type="text/javascript"
      src="./jweixin.js"
    ></script>
    <script>
      // 监听 hash 中 modelUrl 的变化并刷新页面
      (function() {
        let currentModelUrl = null;

        // 从 hash 中提取 modelUrl 参数
        function getModelUrlFromHash() {
          const hash = window.location.hash;
          const urlParams = new URLSearchParams(hash.split('?')[1] || '');
          return urlParams.get('modelUrl');
        }

        // 初始化当前 modelUrl
        currentModelUrl = getModelUrlFromHash();

        // 监听 hashchange 事件
        window.addEventListener('hashchange', function() {
          const newModelUrl = getModelUrlFromHash();
          console.log('hashchange newModelUrl', newModelUrl);
          // 如果 modelUrl 发生了变化，刷新页面
          console.log('hashchange currentModelUrl', currentModelUrl);
          if (currentModelUrl !== newModelUrl && newModelUrl !== null) {
            console.log('ModelUrl changed from', currentModelUrl, 'to', newModelUrl, '- reloading page');
            window.location.reload();
          }
          if (newModelUrl === null && currentModelUrl === null) {
            window.location.reload();
          }
          currentModelUrl = newModelUrl;
        });

        // 也监听 popstate 事件以确保向后/向前导航也能被捕获
        window.addEventListener('popstate', function() {
          const newModelUrl = getModelUrlFromHash();
          console.log('popstate newModelUrl', newModelUrl);
          if (currentModelUrl !== newModelUrl && newModelUrl !== null) {
            console.log('ModelUrl changed via popstate from', currentModelUrl, 'to', newModelUrl, '- reloading page');
            window.location.reload();
          }
          
          currentModelUrl = newModelUrl;
        });
      })();
    </script>
  </body>
</html>
